<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Project - Standalone</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
  <style>
    body {
      background: whitesmoke;
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .add-project-form {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 24px rgba(80, 0, 120, 0.07);
      padding: 36px 32px 28px 32px;
      max-width: 1400px;
      width: 70%;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    .add-project-form h2 {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 2rem;
      color: #6c63ff;
      margin-bottom: 18px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 7px;
    }
    .form-group label {
      font-weight: 500;
      color: #23263a;
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 1.08rem;
    }
    .form-group input,
    .form-group select,
    .form-group textarea {
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      font-size: 1rem;
      background: #f7f8fa;
      transition: border-color 0.2s;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: #6c63ff;
      outline: none;
    }
    .form-group.form-full {
      width: 100%;
    }
    .submit-btn {
      margin-top: 18px;
      background: #6c63ff;
      color: #fff;
      font-weight: 600;
      font-size: 1.1rem;
      padding: 12px 0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(108,99,255,0.08);
      transition: background 0.2s;
    }
    .submit-btn:disabled {
      background: #bdbdbd;
      cursor: not-allowed;
    }
    .notification {
      margin-top: 18px;
      padding: 12px 18px;
      border-radius: 8px;
      font-size: 1.08rem;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(108,99,255,0.08);
    }
    .notification.success {
      background: #e8f9f1;
      color: #1a7f5a;
      border: 1px solid #1a7f5a33;
    }
    .notification.error {
      background: #fff0f0;
      color: #d32f2f;
      border: 1px solid #d32f2f33;
    }
    .spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
    .design-links-fields {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
    }
    .design-link-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .add-link-btn, .remove-link-btn {
      background: none;
      border: none;
      color: #6c63ff;
      cursor: pointer;
      font-size: 1.1rem;
      padding: 2px 6px;
      display: flex;
      align-items: center;
      gap: 4px;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .add-link-btn:hover, .remove-link-btn:hover {
      background: #f0f0ff;
    }
    .design-previews {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    .design-preview-wrapper {
      position: relative;
      display: inline-block;
    }
    .design-preview-img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 4px rgba(80,0,120,0.07);
    }
    .remove-screenshot-btn {
      position: absolute;
      top: 2px;
      right: 2px;
      background: rgba(255,255,255,0.85);
      border: none;
      border-radius: 50%;
      color: #e53935;
      font-size: 1rem;
      padding: 3px 5px;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(80,0,120,0.07);
      transition: background 0.2s;
      z-index: 2;
    }
    .remove-screenshot-btn:hover {
      background: #ffeaea;
    }
    .design-ref-type-select {
      margin-bottom: 10px;
      margin-top: 2px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
      font-size: 1rem;
      background: #f7f8fa;
      width: 220px;
    }
    .row {
      display: flex;
      gap: 12px;
    }
    .form-row {
      display: flex;
      gap: 18px;
    }
    .form-row .form-group {
      flex: 1 1 0;
      min-width: 0;
    }
    @media (max-width: 700px) {
      .form-row {
        flex-direction: column;
        gap: 0;
      }
    }
    @media (max-width: 600px) {
    .add-project-form{
        width: 100%;
        max-width: 100%;
        margin: 0 auto;;
    }

    .add-project-form h2{
        font-size: 1.2rem;
        font-weight: 600;
    }
      .design-ref-type-select {
        width: 100%;
      }
    }
    /* Add stat card styles */
    .projects-stats-row {
      display: flex;
      gap: 22px;
      margin-bottom: 18px;
      flex-wrap: wrap;
      justify-content: flex-start;
    }
    .stat-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(80, 0, 120, 0.07);
      padding: 18px 22px 14px 18px;
      min-width: 140px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      border: 2.5px solid #ececff;
      font-size: 1.08rem;
      font-weight: 600;
      position: relative;
      transition: box-shadow 0.18s, border-color 0.18s;
    }
    .stat-card i {
      font-size: 1.5rem;
      margin-bottom: 2px;
    }
    .stat-label {
      font-size: 0.98rem;
      color: #888;
      font-weight: 500;
    }
    .stat-value {
      font-size: 1.35rem;
      font-weight: 700;
      margin-top: 2px;
    }
    .stat-total { border-color: #6c63ff; color: #6c63ff; }
    .stat-total i { color: #6c63ff; }
    .stat-completed { border-color: #43a047; color: #43a047; }
    .stat-completed i { color: #43a047; }
    .stat-working { border-color: #1976d2; color: #1976d2; }
    .stat-working i { color: #1976d2; }
    .stat-pending { border-color: #ffb300; color: #ffb300; }
    .stat-pending i { color: #ffb300; }
    .stat-cancelled { border-color: #d32f2f; color: #d32f2f; }
    .stat-cancelled i { color: #d32f2f; }
    .stat-paid { border-color: #388e3c; color: #388e3c; }
    .stat-paid i { color: #388e3c; }
    .stat-payment-pending { border-color: #b28704; color: #b28704; }
    .stat-payment-pending i { color: #b28704; }
    .stat-amount-total { border-color: #6c63ff; color: #6c63ff; }
    .stat-amount-total i { color: #6c63ff; }
    .stat-amount-paid { border-color: #388e3c; color: #388e3c; }
    .stat-amount-paid i { color: #388e3c; }
    .stat-amount-pending { border-color: #b28704; color: #b28704; }
    .stat-amount-pending i { color: #b28704; }
    @media (max-width: 900px) {
      .projects-stats-row {
        flex-wrap: wrap;
        gap: 12px;
      }
      .stat-card {
        min-width: 120px;
        padding: 14px 10px 10px 10px;
      }
    }
    .form-group label i, .add-project-form h2 i {
      min-width: 1.5em;
    }
    .add-project-form h2 i { color: #6c63ff; }
    .form-group label i.fa-file-alt { color: #ffb300; }
    .form-group label i.fa-tags { color: #00b894; }
    .form-group label i.fa-wallet { color: #388e3c; }
    .form-group label i.fa-calendar-alt { color: #1976d2; }
    .form-group label i.fa-link { color: #574fd6; }
    .form-group label i.fa-globe { color: #43a047; }
    .form-group label i.fa-info-circle { color: #8e24aa; }
    .form-group label i.fa-image { color: #e53935; }
    .rte-toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 6px;
    }
    .rte-toolbar button {
      background: #f7f8fa;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 1.1rem;
      cursor: pointer;
      color: #6c63ff;
      transition: background 0.18s, color 0.18s;
    }
    .rte-toolbar button.active, .rte-toolbar button:focus {
      background: #e0e0ff;
      color: #23263a;
      outline: none;
    }
    .rte-editor {
      min-height: 120px;
      max-height: 320px;
      background: #f7f8fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 10px 12px;
      font-size: 1rem;
      font-family: inherit;
      margin-bottom: 2px;
      overflow-y: auto;
      transition: border-color 0.2s;
    }
    .rte-editor:focus {
      border-color: #6c63ff;
      outline: none;
    }
    .loader-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255,255,255,0.7);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      color: #6c63ff;
      display: none;
    }
    .loader-overlay.active {
      display: flex;
    }
  </style>
</head>
<body>
  <div id="loaderOverlay" class="loader-overlay"><i class="fa-solid fa-spinner spin"></i></div>
  <form class="add-project-form" id="addProjectForm">
    <h2><i class="fa-solid fa-plus"></i> Add New Project</h2>
    <div class="form-row">
      <div class="form-group">
        <label><i class="fa-solid fa-file-alt"></i> Name</label>
        <input type="text" name="name" placeholder="Project Name" required />
      </div>
      <div class="form-group">
        <label><i class="fa-solid fa-tags"></i> Type</label>
        <select name="type" id="typeSelect" required>
          <option value="">Select Type</option>
          <option value="wordpress">WordPress</option>
          <option value="code">Code</option>
          <option value="design">Design</option>
          <option value="other">Other</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label><i class="fa-solid fa-wallet"></i> Amount (PKR)</label>
        <input type="number" name="amount" placeholder="Amount in PKR" min="0" required />
      </div>
      <div class="form-group">
        <label><i class="fa-solid fa-calendar-alt"></i> Deadline</label>
        <input type="date" name="deadline" required />
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label><i class="fa-solid fa-link"></i> Link</label>
        <input type="url" name="link" placeholder="Project Link" />
      </div>
      <div class="form-group">
        <label><i class="fa-solid fa-globe"></i> Web Niche</label>
        <input type="text" name="niche" placeholder="Web Niche" />
      </div>
    </div>
    <div class="form-group form-full">
      <label><i class="fa-solid fa-info-circle"></i> Instructions</label>
      <div class="rte-toolbar">
        <button type="button" data-cmd="bold" title="Bold"><i class="fa-solid fa-bold"></i></button>
        <button type="button" data-cmd="italic" title="Italic"><i class="fa-solid fa-italic"></i></button>
        <button type="button" data-cmd="underline" title="Underline"><i class="fa-solid fa-underline"></i></button>
        <button type="button" data-cmd="insertOrderedList" title="Ordered List"><i class="fa-solid fa-list-ol"></i></button>
        <button type="button" data-cmd="insertUnorderedList" title="Unordered List"><i class="fa-solid fa-list-ul"></i></button>
      </div>
      <div class="rte-editor" id="instructionsEditor" contenteditable="true" placeholder="Instructions"></div>
    </div>
    <div class="form-group form-full">
      <label><i class="fa-solid fa-image"></i> Design References</label>
      <select id="designRefType" class="design-ref-type-select">
        <option value="link">Reference Link(s)</option>
        <option value="screenshot">Screenshot(s)</option>
      </select>
      <div id="designLinksFields" class="design-links-fields">
        <div class="design-link-row">
          <input type="text" name="designLinks[]" placeholder="Reference Link" />
          <button type="button" class="add-link-btn" id="addLinkBtn"><i class="fa-solid fa-plus"></i></button>
        </div>
      </div>
      <div id="designScreenshotsField" style="display:none;">
        <input type="file" id="designRefsInput" accept="image/*" multiple />
        <div class="design-previews" id="designPreviews"></div>
      </div>
    </div>
    <button type="submit" class="submit-btn" id="submitBtn"><i class="fa-solid fa-plus"></i> Add Project</button>
    <div id="notification" class="notification" style="display:none;"></div>
  </form>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // Firebase config (replace with your own or use env)
    const firebaseConfig = {
      apiKey: "AIzaSyBRE9ciGghDTxa3wlDC2R0BqPqMWCCicRg",
      authDomain: "projectpulse-669e4.firebaseapp.com",
      projectId: "projectpulse-669e4",
      storageBucket: "projectpulse-669e4.appspot.com",
      messagingSenderId: "1096589928499",
      appId: "1:1096589928499:web:a761c5d7d29779f2799b46"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // UI logic
    const designRefType = document.getElementById('designRefType');
    const designLinksFields = document.getElementById('designLinksFields');
    const designScreenshotsField = document.getElementById('designScreenshotsField');
    const designRefsInput = document.getElementById('designRefsInput');
    const designPreviews = document.getElementById('designPreviews');
    const addLinkBtn = document.getElementById('addLinkBtn');
    let designLinksCount = 1;
    let designFiles = [];

    designRefType.addEventListener('change', function() {
      if (this.value === 'link') {
        designLinksFields.style.display = '';
        designScreenshotsField.style.display = 'none';
      } else {
        designLinksFields.style.display = 'none';
        designScreenshotsField.style.display = '';
      }
    });

    addLinkBtn.addEventListener('click', function() {
      const row = document.createElement('div');
      row.className = 'design-link-row';
      row.innerHTML = `<input type="text" name="designLinks[]" placeholder="Reference Link" /> <button type="button" class="remove-link-btn"><i class="fa-solid fa-trash"></i></button>`;
      designLinksFields.appendChild(row);
      row.querySelector('.remove-link-btn').onclick = function() {
        designLinksFields.removeChild(row);
      };
    });

    designRefsInput.addEventListener('change', async function(e) {
      designFiles = [];
      designPreviews.innerHTML = '';
      const files = Array.from(e.target.files);
      for (const file of files) {
        const base64 = await compressImage(file);
        designFiles.push({ name: file.name, base64 });
        const wrapper = document.createElement('div');
        wrapper.className = 'design-preview-wrapper';
        wrapper.innerHTML = `<img src="${base64}" class="design-preview-img" /><button type="button" class="remove-screenshot-btn"><i class="fa-solid fa-trash"></i></button>`;
        wrapper.querySelector('.remove-screenshot-btn').onclick = function() {
          designPreviews.removeChild(wrapper);
          designFiles = designFiles.filter(f => f.base64 !== base64);
        };
        designPreviews.appendChild(wrapper);
      }
    });

    function compressImage(file, maxWidth = 800, maxHeight = 800, quality = 0.7) {
      return new Promise((resolve, reject) => {
        const img = new window.Image();
        const reader = new FileReader();
        reader.onload = (e) => { img.src = e.target.result; };
        img.onload = () => {
          const canvas = document.createElement('canvas');
          let width = img.width;
          let height = img.height;
          if (width > maxWidth) {
            height = Math.round((maxWidth / width) * height);
            width = maxWidth;
          }
          if (height > maxHeight) {
            width = Math.round((maxHeight / height) * width);
            height = maxHeight;
          }
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);
          canvas.toBlob(
            (blob) => {
              const reader2 = new FileReader();
              reader2.onloadend = () => resolve(reader2.result);
              reader2.onerror = reject;
              reader2.readAsDataURL(blob);
            },
            'image/jpeg',
            quality
          );
        };
        img.onerror = reject;
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // Default cover images by type
    const COVER_IMAGES = {
      code: 'https://images.nightcafe.studio/jobs/08rM87hliQ7dDYFHojx9/08rM87hliQ7dDYFHojx9--0--hspau.jpg?tr=w-1600,c-at_max',
      wordpress: 'https://images.nightcafe.studio/jobs/8U2Dkd6cTzANnf2o9s0z/8U2Dkd6cTzANnf2o9s0z--1--anf4l.jpg?tr=w-1600,c-at_max',
      design: 'https://images.nightcafe.studio/jobs/coCzj87MTB3NNbwRUa17/coCzj87MTB3NNbwRUa17--0--gwp55.jpg?tr=w-1600,c-at_max',
      other: 'https://images.nightcafe.studio/jobs/ur35GpAAHFDlW7CR1bZF/ur35GpAAHFDlW7CR1bZF--0--jw2yq.jpg?tr=w-1600,c-at_max',
    };

    // Form submit
    document.getElementById('addProjectForm').onsubmit = async function(e) {
      e.preventDefault();
      const form = e.target;
      document.getElementById('loaderOverlay').classList.add('active');
      const data = {
        name: form.name.value,
        type: form.type.value,
        amount: form.amount.value ? Number(form.amount.value) : null,
        deadline: form.deadline.value ? new Date(form.deadline.value) : null,
        link: form.link.value,
        niche: form.niche.value,
        instructions: document.getElementById('instructionsEditor').innerHTML,
        designRefType: designRefType.value,
        designLinks: [],
        designFiles: [],
        createdAt: new Date(),
        coverImage: COVER_IMAGES[form.type.value] || COVER_IMAGES['other'],
      };
      if (designRefType.value === 'link') {
        const linkInputs = form.querySelectorAll('input[name="designLinks[]"]');
        data.designLinks = Array.from(linkInputs).map(input => input.value).filter(Boolean);
      } else {
        data.designFiles = designFiles;
      }
      showNotification('Adding project...', 'success', true);
      try {
        await db.collection('projects').add(data);
        showNotification('Project added successfully!', 'success');
        form.reset();
        designPreviews.innerHTML = '';
        designFiles = [];
        document.getElementById('loaderOverlay').classList.remove('active');
      } catch {
        showNotification('Failed to add project.', 'error');
        document.getElementById('loaderOverlay').classList.remove('active');
      }
    };

    // RTE toolbar logic (fix: focus editor before execCommand)
    const instructionsEditor = document.getElementById('instructionsEditor');
    document.querySelectorAll('.rte-toolbar button').forEach(btn => {
      btn.onmousedown = function(e) { e.preventDefault(); };
      btn.onclick = function() {
        instructionsEditor.focus();
        document.execCommand(btn.getAttribute('data-cmd'), false, null);
      };
    });

    function showNotification(msg, type, loading) {
      const notif = document.getElementById('notification');
      notif.innerHTML = (loading ? '<i class="fa-solid fa-spinner spin"></i> ' : '') + msg;
      notif.className = 'notification ' + type;
      notif.style.display = '';
      if (!loading) setTimeout(() => notif.style.display = 'none', 2500);
    }
  </script>
</body>
</html> 
